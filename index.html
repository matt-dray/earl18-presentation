<!DOCTYPE html>
<html>
  <head>
    <title>Crosstalk #EARL18</title>
    <meta charset="utf-8">
    <meta name="author" content="Matt Dray | Dept for Education | EARL 2018" />
    <link href="libs/font-awesome/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style/style.css" type="text/css" />
    <link rel="stylesheet" href="style/style-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: center, middle, inverse

# Crosstalk <i class="fas  fa-comments "></i>

### Shiny-like without Shiny

.image-30[![](img/earl_logo_light.png)]

### Matt Dray | Dept for Education | #EARL2018

---
class: center, middle

# TL;DR&amp;ast;

Need to create a small interactive app without a server or Shiny?

Try the [`crosstalk`](http://rstudio.github.io/crosstalk/) package.

.footnote[

&amp;ast;Too long; didn't read

]

---
class: center, middle

# Am I talking about a real policy?

Nope, sorry.

Schools in this example were chosen randomly.

???

The content of this talk does not reflect or constitute official government policy.

The data are from published sources.

---
class: center, middle

# The ask

Visualise school locations to help make a policy decision

--

Shareable

--

Cheap

--

Quick

--

(Reusable)

???

Area-based programmes operate at DfE all the time.

Typically we produce static maps.

ArcMap is not viable. We don't have the licenses.

I iterated over four steps to produce something that my users wanted.

(Or rather didn't even know they wanted.)

And how the `crosstalk` package greatly improved the product.

---
class: inverse, center, middle

# Solution 1

[`leaflet`](https://rstudio.github.io/leaflet/) interactive map

---
class: center, middle

.image-100[![](img/solution1-1.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/01_leaflet.html)

???

Leaflet is an htmlwidget. It wraps a JavaScript visualisation in R code.

There are other widgets: plotly, DT, etc (https://www.htmlwidgets.org/).

This is a simple example. Each point is a school. You can conditionally change the colour or style of markers.

The output here is HTML, so can be shared easily as a file via email and opened with the user's browser. 

I've also hosted each of the examples in this presentation via GitHub. See the address bar or click the link.

---

class: center, middle

.image-100[![](img/solution1-2.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/01_leaflet.html)

???

It operated intuitively for our users, who were used to things like Google Maps.

Pan, zoom, select markers to show pop-ups.

You can add things like measuring tools, which is the function provided by the button in the top right.

---
class: center, middle

# Solution 1

.pull-left[

<i class="fas  fa-check fa-2x "></i>

interactive

intuitive

]

--

.pull-right[

<i class="fas  fa-times fa-2x "></i>

documentation?

]

---
class: inverse, center, middle

# Solution 2

[`leaflet`](https://rstudio.github.io/leaflet/) interactive map

in a [`flexdashboard`](https://rmarkdown.rstudio.com/flexdashboard/)

---
class: center, middle

.image-100[![](img/solution2.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/02_leaflet-flexdash.html)

???

Flexdashbaord allows you to build a framework using R Markdown where you put visualisations, commentary, etc.

Typically you use this for creating dashboards. You can control the layout and style.

So now we have space to put documentation for users (how to, purpose, contact info, etc).

I've also added a source code button for fellow analysts to see and adapt the code.

---
class: center, middle

# Solution 2

.pull-left[

<i class="fas  fa-check fa-2x "></i>

documentation

self-service

]

???

'Self-service' meaning that we don't need to be in the room while users explore the data themselves.

--

.pull-right[

<i class="fas  fa-times fa-2x "></i>

tabular data?

searchable?

]

???

Users were pleased but still had some issues.

How can we add more info into the pop-ups without overloading? Maybe some kind of table.

How can they search for specific schools?

---
class: inverse, center, middle

# Solution 3

[`leaflet`](https://rstudio.github.io/leaflet/) interactive map

in a [`flexdashboard`](https://rmarkdown.rstudio.com/flexdashboard/)

with a [`DT`](https://rstudio.github.io/DT/) interactive table


---
class: center, middle

.image-100[![](img/solution3-1.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/03_leaflet-flexdash-dt.html)

???

The DT package's `datatable` function is another htmlwidget that can provide more info about each school. 

---
class: center, middle

.image-100[![](img/solution3-2.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/03_leaflet-flexdash-dt.html)

???

And you can use the built-in search or filter boxes to dig down.

---
class: center, middle

# Solution 3

.pull-left[

<i class="fas  fa-check fa-2x "></i>

tabular data

searchable

]

--

.pull-right[

<i class="fas  fa-times fa-2x "></i>

download?

linked table and map?

]

???

Great, but the users wanted to be able to export the filtered informatino rather than copy-pasting.

Also - a good question - why doesn't filtering update the map too?

---
class: inverse, center, middle

# What now?

???

Do we have to resort to Shiny now?

But this is problematic: we didn't have infrastructure to serve Shiny apps.

Also we'd have to rewrite the code.

And Shiny code is less intuitive for other analysts in my team versus the simplicity of R Markdown and htmlwidgets.

---
class: center, middle

# Current model

.image-100[![](img/model-without.png)]

???

Data feeds into map.

Data feeds into datatable.

Updating one htmlwidget doesn't update the other.

---
class: center, middle

# Ideal model

.image-100[![](img/model-with.png)]

???

What if the map and datatable could be linked through a _shared_ data object rather than relying on their own 'copies' of the data?

---
class: center, middle

# Ideal model

.image-100[![](img/model-with-filter.png)]

???

Of course, some bonus filtering options would be great: dropdowns, checkboxes and sliders maybe.

Well, guess what?

---

# Crosstalk by Joe Cheng

.pull-left[

Crosstalk achieves:

&gt; static HTML documents that &lt;b&gt;do not require Shiny&lt;/b&gt; or any kind of server support and yet they can have &lt;b&gt;interactivity between widgets&lt;/b&gt;

]

.pull-right[

![Joe Cheng](https://avatars3.githubusercontent.com/u/129551?s=400&amp;v=4)

]

???

This ideal model already exists!

---

# A small code change

#### Before


```r
data &lt;- readRDS("data/some_data.RDS")  # get data

datatable(data)  # interactive table

leaflet(data) %&gt;% addTiles() %&gt;% addMarkers()  # map
```

--

#### After


```r
data &lt;- readRDS("data/some_data.RDS")

*shared &lt;- SharedData$new(data)

datatable(shared)

leaflet(shared) %&gt;% addTiles() %&gt;% addMarkers()
```

???

Do everything as usual, but create a 'shared data' object and refer to that in the htmlwidgets you want to talk to each other.

---
class: center, middle

# <i class="fas  fa-exclamation-triangle "></i> Limitations <i class="fas  fa-exclamation-triangle "></i>

htmlwidgets must be [made Crosstalk-compatible](http://rstudio.github.io/crosstalk/widgets.html)

Aggregate and summary views not yet available 

You can't use 'large' datasets

???

1. There is guidance for the tweak. `leaflet`, `DT`, `plotly` are fine for 95% of our purposes.
2. Right now only linked brushing and filtering of views that show individual data points, not aggregate or summary views.
3. Depenedent on browser limitations.

---
class: inverse, center, middle

# Okay, Solution 4

[`leaflet`](https://rstudio.github.io/leaflet/) interactive map

in a [`flexdashboard`](https://rmarkdown.rstudio.com/flexdashboard/)

with a [`DT`](https://rstudio.github.io/DT/) interactive table

linked with [`crosstalk`](https://rstudio.github.io/crosstalk/)

---
class: center, middle

.image-100[![](img/solution4-1.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

???

Filters (dropdown, checkboxes, sliders), datatable (bonus buttons to download and select visible columns), map.

---
class: center, middle

.image-100[![](img/solution4-2.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

???

See how using the filters affect the table and the map?

---
class: center, middle

.image-100[![](img/solution4-3.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

???

You can even click a row in the datatable to highlight it on the map.

See how the others are made more transparent.

---
class: center, middle

.image-100[![](img/solution4-4.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

???

You can filter the table to filter the map and vice versa.

You can use 'linked brushing' to select from the map and filter the datatable.

Select the button underneath the zoom options and a square appears that you can resize and drag over points of interest.

---
class: center, middle

.image-100[![](img/solution4-5.PNG)]

Demo available [here](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

???

Where's the documentation? Moved to a separate tab.

---
class: center, middle

# Solution 4

.pull-left[

<i class="fas  fa-check fa-2x "></i>

htmlwidgets linked

filtering and brushing

downloads

]

--

.pull-right[

<i class="fas  fa-times fa-2x "></i>

more points!

more widgets!

]

---
class: center, middle

# Impact

&gt; the maps have been added to a submission for the minister

&lt;p&gt;
&gt; policy and the external stakeholders have been extremely impressed 

&lt;p&gt;
&gt; due to the positive feedback we are now using the same process for [another policy]

---
class: center, middle

# TL;DR

Need to create a small interactive app without a server or Shiny?

Try the [`crosstalk`](http://rstudio.github.io/crosstalk/) package.

---

# Resources

.pull-left[

#### This presentation

[Hosted online](https://matt-dray.github.io/earl18-presentation/)

[GitHub repo](https://github.com/matt-dray/earl18-presentation)

Made with Yihui Xie's [Xaringan package](https://bookdown.org/yihui/rmarkdown/xaringan.html)

#### Demos

Solutions [1](https://matt-dray.github.io/earl18-crosstalk/01_leaflet.html), [2](https://matt-dray.github.io/earl18-crosstalk/02_leaflet-flexdash.html), [3](https://matt-dray.github.io/earl18-crosstalk/03_leaflet-flexdash-dt.html) and [4](https://matt-dray.github.io/earl18-crosstalk/04_leaflet-flexdash-dt-crosstalk.html)

[GitHub repo](https://github.com/matt-dray/earl18-crosstalk)

]

.pull-right[

#### Crosstalk docs

[Site](https://rstudio.github.io/crosstalk/) and [GitHub repo](https://github.com/rstudio/crosstalk)

CRAN [manual](https://cran.r-project.org/web/packages/crosstalk/crosstalk.pdf) and [details](https://CRAN.R-project.org/package=crosstalk)

Talk at [rstudio::conf 2017](https://www.rstudio.com/resources/videos/linking-html-widgets-with-crosstalk/)

#### Examples

[Gapminder example](http://rstudio-pubs-static.s3.amazonaws.com/209203_02f14fea3274448bbbf8d04c99c6051b.html)

Demo [without](https://rpubs.com/jcheng/dash1) and [with](https://rpubs.com/jcheng/dash2) Crosstalk

]

---
class: inverse, center, middle

# Matt Dray

<i class="fas  fa-envelope "></i> [matthew.dray@education.gov.uk](mailto:matthew.dray@education.gov.uk)

<i class="fas  fa-globe "></i> [rostrum.blog](https://rostrum.blog) | <i class="fab  fa-twitter "></i> [twitter.com/mattdray](https://www.twitter.com/mattdray) | <i class="fab  fa-github "></i>  [github.com/matt-dray](https://www.github.com/matt-dray)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
